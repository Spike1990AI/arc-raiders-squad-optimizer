<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arc Raiders - Squad Optimizer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #fff;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .player-selector {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
        }

        .player-btn {
            padding: 15px 40px;
            font-size: 1.1em;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: #fff;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .player-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .player-btn.active {
            background: #4CAF50;
            border-color: #4CAF50;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
        }

        .priority-banner {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        }

        .priority-banner h2 {
            font-size: 1.5em;
            margin-bottom: 10px;
        }

        .priority-banner p {
            font-size: 1.1em;
            line-height: 1.6;
        }

        .workstation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .workstation-card {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            padding: 20px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
        }

        .workstation-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .workstation-card.keystone {
            border: 3px solid #FFD700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
        }

        .keystone-badge {
            display: inline-block;
            background: #FFD700;
            color: #000;
            padding: 5px 12px;
            border-radius: 5px;
            font-weight: bold;
            font-size: 0.9em;
            margin-left: 10px;
        }

        .workstation-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .workstation-title {
            font-size: 1.5em;
            font-weight: bold;
        }

        .level-indicator {
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 15px;
            border-radius: 5px;
            font-weight: bold;
        }

        .upgrade-section {
            margin-top: 15px;
        }

        .next-upgrade {
            background: rgba(76, 175, 80, 0.2);
            border: 2px solid #4CAF50;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
        }

        .next-upgrade h4 {
            color: #4CAF50;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .requirements-list {
            list-style: none;
            margin-top: 10px;
        }

        .requirement-item {
            display: flex;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            border-left: 4px solid transparent;
        }

        .requirement-item.farm {
            border-left-color: #ff9800;
        }

        .requirement-item.craft {
            border-left-color: #4CAF50;
        }

        .requirement-item.buy {
            border-left-color: #2196F3;
        }

        .item-icon {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            margin-right: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
        }

        .item-details {
            flex: 1;
        }

        .item-name {
            font-weight: bold;
            font-size: 1.1em;
        }

        .item-quantity {
            color: #FFD700;
            font-weight: bold;
            margin-left: 5px;
        }

        .item-source {
            font-size: 0.9em;
            opacity: 0.8;
            margin-top: 3px;
        }

        .type-badge {
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.85em;
            font-weight: bold;
            margin-left: 10px;
        }

        .type-badge.farm {
            background: #ff9800;
            color: #000;
        }

        .type-badge.craft {
            background: #4CAF50;
            color: #fff;
        }

        .type-badge.buy {
            background: #2196F3;
            color: #fff;
        }

        .warning-banner {
            background: rgba(255, 152, 0, 0.2);
            border: 2px solid #ff9800;
            border-radius: 5px;
            padding: 10px;
            margin-top: 10px;
        }

        .warning-banner.danger {
            background: rgba(244, 67, 54, 0.2);
            border-color: #f44336;
        }

        .cross-ref-warning {
            font-size: 0.95em;
            margin-top: 5px;
        }

        .cross-ref-warning strong {
            color: #FFD700;
        }

        .unlocks-section {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }

        .unlocks-section h5 {
            color: #4CAF50;
            margin-bottom: 8px;
        }

        .unlocks-list {
            list-style: none;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .unlock-item {
            background: rgba(76, 175, 80, 0.2);
            padding: 5px 12px;
            border-radius: 5px;
            font-size: 0.9em;
            border: 1px solid #4CAF50;
        }

        .legend {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
        }

        .legend h3 {
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .legend-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .legend-badge {
            padding: 8px 15px;
            border-radius: 5px;
            font-weight: bold;
            font-size: 0.9em;
            white-space: nowrap;
        }

        .max-level {
            opacity: 0.6;
        }

        .max-level-badge {
            background: #4CAF50;
            color: #fff;
            padding: 10px 20px;
            border-radius: 5px;
            font-weight: bold;
            text-align: center;
            margin-top: 10px;
        }

        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            font-size: 0.9em;
            opacity: 0.8;
        }

        @media (max-width: 768px) {
            .workstation-grid {
                grid-template-columns: 1fr;
            }

            .player-selector {
                flex-direction: column;
            }

            h1 {
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>‚öîÔ∏è Arc Raiders - Squad Optimizer</h1>
            <p class="subtitle">Smart Workshop Upgrade Planning with Cross-Reference Protection</p>
        </header>

        <div class="player-selector">
            <button class="player-btn" data-player="steve">Steve</button>
            <button class="player-btn" data-player="alf">Alf</button>
            <button class="player-btn" data-player="indie">Indie</button>
        </div>

        <div id="priority-message"></div>

        <div id="workstations"></div>

        <div class="legend">
            <h3>üìã Material Types Guide</h3>
            <div class="legend-grid">
                <div class="legend-item">
                    <span class="legend-badge" style="background: #ff9800; color: #000;">üåæ FARM</span>
                    <span>Must loot or kill enemies</span>
                </div>
                <div class="legend-item">
                    <span class="legend-badge" style="background: #4CAF50; color: #fff;">‚úÖ CRAFT</span>
                    <span>Make at Refiner station</span>
                </div>
                <div class="legend-item">
                    <span class="legend-badge" style="background: #2196F3; color: #fff;">üí∞ BUY</span>
                    <span>Purchase from Celeste</span>
                </div>
                <div class="legend-item">
                    <span class="legend-badge" style="background: #FFD700; color: #000;">üîë KEYSTONE</span>
                    <span>Unlocks crafting for others</span>
                </div>
            </div>
        </div>

        <footer>
            <p><strong>Data Sources:</strong> Arc Raiders Wiki | ARDB Tools | GAM3S.GG</p>
            <p>Made for Steve, Alf & Indie | v1.0</p>
        </footer>
    </div>

    <script>
        let gameData = null;
        let currentPlayer = null;

        // Load game data
        fetch('data/upgrades.json')
            .then(response => response.json())
            .then(data => {
                gameData = data;
                initializeApp();
            })
            .catch(error => {
                console.error('Error loading game data:', error);
                alert('Failed to load game data. Please refresh the page.');
            });

        function initializeApp() {
            // Set up player selection
            const playerBtns = document.querySelectorAll('.player-btn');
            playerBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const player = btn.dataset.player;
                    selectPlayer(player);
                });
            });

            // Load saved player from localStorage or default to Steve
            const savedPlayer = localStorage.getItem('arcRaidersPlayer') || 'steve';
            selectPlayer(savedPlayer);
        }

        function selectPlayer(player) {
            currentPlayer = player;
            localStorage.setItem('arcRaidersPlayer', player);

            // Update button states
            document.querySelectorAll('.player-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.player === player);
            });

            // Render workstations
            renderWorkstations();
        }

        function renderWorkstations() {
            if (!gameData || !currentPlayer) return;

            const playerData = gameData.playerStatus[currentPlayer];
            const workstationsContainer = document.getElementById('workstations');
            const priorityMessage = document.getElementById('priority-message');

            // Check if Refiner needs upgrade
            const refinerLevel = playerData.workstations.refiner;
            if (refinerLevel < 2) {
                priorityMessage.innerHTML = `
                    <div class="priority-banner">
                        <h2>üîë PRIORITY: Upgrade Refiner to Level 2 First!</h2>
                        <p><strong>Why critical:</strong> Refiner Lv2 unlocks crafting for Advanced Mechanical Components, Advanced Electrical Components, Antiseptic, and ARC Circuitry - materials needed for ALL Level 3 workstation upgrades.</p>
                        <p><strong>Impact:</strong> Stop farming Advanced materials - craft them instead! This is the most important upgrade in the game.</p>
                    </div>
                `;
            } else {
                priorityMessage.innerHTML = '';
            }

            let html = '<div class="workstation-grid">';

            // Render each workstation
            for (const [key, station] of Object.entries(gameData.workstations)) {
                const currentLevel = playerData.workstations[key];
                const maxLevel = station.levels[station.levels.length - 1].level;
                const isMaxed = currentLevel >= maxLevel;
                const isKeystone = station.keystone || false;

                html += `
                    <div class="workstation-card ${isKeystone ? 'keystone' : ''} ${isMaxed ? 'max-level' : ''}">
                        <div class="workstation-header">
                            <div class="workstation-title">
                                ${station.name}
                                ${isKeystone ? '<span class="keystone-badge">üîë KEYSTONE</span>' : ''}
                            </div>
                            <div class="level-indicator">Lv ${currentLevel}</div>
                        </div>
                `;

                if (isMaxed) {
                    html += '<div class="max-level-badge">‚úÖ MAX LEVEL ACHIEVED</div>';
                } else {
                    // Find next upgrade
                    const nextLevel = station.levels.find(l => l.level === currentLevel + 1);
                    if (nextLevel) {
                        html += renderUpgrade(nextLevel, station.name, key);
                    }
                }

                html += '</div>';
            }

            html += '</div>';
            workstationsContainer.innerHTML = html;
        }

        function renderUpgrade(level, stationName, stationKey) {
            let html = `
                <div class="next-upgrade">
                    <h4>Next: Level ${level.level}${level.name ? ` (${level.name})` : ''}</h4>
                    <ul class="requirements-list">
            `;

            // Render each requirement
            for (const req of level.requirements) {
                const typeClass = req.type;
                const icon = getTypeIcon(req.type);

                html += `
                    <li class="requirement-item ${typeClass}">
                        <div class="item-icon">${icon}</div>
                        <div class="item-details">
                            <div>
                                <span class="item-name">${req.item}</span>
                                <span class="item-quantity">√ó${req.quantity}</span>
                                <span class="type-badge ${typeClass}">${req.type.toUpperCase()}</span>
                            </div>
                            ${renderSource(req)}
                            ${renderCrossReference(req.item)}
                            ${req.note ? `<div class="item-source" style="color: #ff9800;">‚ö†Ô∏è ${req.note}</div>` : ''}
                        </div>
                    </li>
                `;
            }

            html += '</ul>';

            // Render unlocks
            if (level.unlocks && level.unlocks.length > 0) {
                html += `
                    <div class="unlocks-section">
                        <h5>üéÅ Unlocks:</h5>
                        <ul class="unlocks-list">
                            ${level.unlocks.map(u => `<li class="unlock-item">${u}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }

            html += '</div>';
            return html;
        }

        function renderSource(req) {
            if (req.type === 'farm' && req.source) {
                return `<div class="item-source">üìç ${req.source}</div>`;
            } else if (req.type === 'craft' && req.craftAt) {
                return `<div class="item-source">üîß Craft at ${req.craftAt}</div>`;
            } else if (req.type === 'buy' && req.seedCost) {
                return `<div class="item-source">üí∞ Buy from Celeste (${req.seedCost} seeds)</div>`;
            }
            return '';
        }

        function renderCrossReference(itemName) {
            if (!gameData.crossReferences || !gameData.crossReferences.multipleUse) return '';

            const crossRef = gameData.crossReferences.multipleUse.find(cr => cr.material === itemName);
            if (!crossRef) return '';

            const isDanger = crossRef.totalNeeded >= 10;

            return `
                <div class="warning-banner ${isDanger ? 'danger' : ''}">
                    <div class="cross-ref-warning">
                        <strong>‚ö†Ô∏è CROSS-REFERENCE:</strong> This material is also needed for
                        ${crossRef.usedBy.join(', ')}.
                        <strong>Total needed: ${crossRef.totalNeeded}</strong>
                        ${crossRef.canCraft ? ` - Can craft at ${crossRef.craftAt}` : ' - CANNOT CRAFT, must farm!'}
                    </div>
                </div>
            `;
        }

        function getTypeIcon(type) {
            switch(type) {
                case 'farm': return 'üåæ';
                case 'craft': return '‚úÖ';
                case 'buy': return 'üí∞';
                default: return '‚ùì';
            }
        }
    </script>
</body>
</html>
