<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arc Raiders - Quest Planner</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #fff;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
            font-weight: bold;
            color: #4CAF50;
        }

        /* ACTIVE QUEST CARD */
        .active-quest-section {
            margin-bottom: 40px;
        }

        .active-quest-card {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.3) 0%, rgba(56, 142, 60, 0.3) 100%);
            border: 3px solid #4CAF50;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 30px rgba(76, 175, 80, 0.4);
            position: relative;
            overflow: hidden;
        }

        .active-quest-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #4CAF50, #8BC34A, #4CAF50);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .quest-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .quest-title {
            font-size: 2em;
            font-weight: bold;
            color: #FFD700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .quest-badge {
            background: #FFD700;
            color: #000;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 1.1em;
        }

        .keystone-badge {
            background: #FFD700;
            color: #000;
            padding: 5px 15px;
            border-radius: 5px;
            font-weight: bold;
            margin-left: 15px;
        }

        .quest-progress {
            margin: 20px 0;
        }

        .progress-bar-wrapper {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            height: 40px;
            overflow: hidden;
            position: relative;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50 0%, #8BC34A 100%);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2em;
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: bold;
            font-size: 1.2em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
        }

        .quest-objectives {
            margin: 25px 0;
        }

        .objectives-title {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 15px;
            color: #4CAF50;
        }

        .objective-list {
            list-style: none;
        }

        .objective-item {
            display: flex;
            align-items: center;
            padding: 15px;
            margin: 10px 0;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            border-left: 5px solid transparent;
            transition: all 0.3s;
        }

        .objective-item.farm { border-left-color: #ff9800; }
        .objective-item.craft { border-left-color: #4CAF50; }
        .objective-item.buy { border-left-color: #2196F3; }

        .objective-item.completed {
            opacity: 0.5;
            background: rgba(76, 175, 80, 0.2);
        }

        .objective-checkbox {
            width: 30px;
            height: 30px;
            margin-right: 15px;
            cursor: pointer;
            flex-shrink: 0;
        }

        .objective-icon {
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            margin-right: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            flex-shrink: 0;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .objective-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .objective-details {
            flex: 1;
        }

        .objective-name {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .objective-quantity {
            color: #FFD700;
            font-size: 1.2em;
            font-weight: bold;
            margin-left: 8px;
        }

        .objective-source {
            font-size: 1em;
            opacity: 0.9;
            margin-top: 5px;
        }

        .type-badge {
            padding: 5px 12px;
            border-radius: 5px;
            font-size: 0.9em;
            font-weight: bold;
            margin-left: 10px;
        }

        .type-badge.farm { background: #ff9800; color: #000; }
        .type-badge.craft { background: #4CAF50; color: #fff; }
        .type-badge.buy { background: #2196F3; color: #fff; }

        .quest-rewards {
            background: rgba(255, 215, 0, 0.2);
            border: 2px solid #FFD700;
            border-radius: 10px;
            padding: 20px;
            margin: 25px 0;
        }

        .rewards-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #FFD700;
            margin-bottom: 10px;
        }

        .reward-items {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .reward-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 8px 15px;
            border-radius: 8px;
            border: 1px solid #FFD700;
        }

        .quest-suggestions {
            background: rgba(33, 150, 243, 0.2);
            border: 2px solid #2196F3;
            border-radius: 10px;
            padding: 20px;
            margin: 25px 0;
        }

        .suggestions-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #2196F3;
            margin-bottom: 15px;
        }

        .suggestion-group {
            background: rgba(0, 0, 0, 0.3);
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }

        .suggestion-group h4 {
            font-size: 1.1em;
            color: #64B5F6;
            margin-bottom: 10px;
        }

        .suggestion-item {
            padding: 8px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .suggestion-item strong {
            color: #FFD700;
        }

        .warning-badge {
            background: #ff9800;
            color: #000;
            padding: 3px 10px;
            border-radius: 5px;
            font-size: 0.85em;
            font-weight: bold;
        }

        .keep-badge {
            background: #4CAF50;
            color: #fff;
            padding: 3px 10px;
            border-radius: 5px;
            font-size: 0.85em;
            font-weight: bold;
        }

        .quest-actions {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }

        .btn {
            padding: 15px 40px;
            font-size: 1.2em;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
        }

        .btn-complete {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: #fff;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
        }

        .btn-complete:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.6);
        }

        .btn-complete:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-back {
            background: rgba(158, 158, 158, 0.3);
            border: 2px solid #9e9e9e;
            color: #fff;
        }

        .btn-back:hover {
            background: rgba(158, 158, 158, 0.5);
        }

        .btn-abandon {
            background: rgba(244, 67, 54, 0.3);
            border: 2px solid #f44336;
            color: #fff;
            flex: 0.5;
        }

        .btn-abandon:hover {
            background: rgba(244, 67, 54, 0.5);
        }

        /* QUEST SELECTION */
        .quest-selection {
            margin-top: 40px;
        }

        .section-title {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
        }

        .quest-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .quest-card {
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .quest-card:hover {
            transform: translateY(-5px);
            border-color: #4CAF50;
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.3);
        }

        .quest-card.completed {
            opacity: 0.6;
            border-color: #4CAF50;
            background: rgba(76, 175, 80, 0.1);
        }

        .quest-card.locked {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .quest-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .quest-card-title {
            font-size: 1.3em;
            font-weight: bold;
        }

        .quest-level {
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 12px;
            border-radius: 5px;
            font-weight: bold;
        }

        .quest-summary {
            font-size: 0.95em;
            opacity: 0.9;
            margin: 10px 0;
        }

        .quest-requirements {
            font-size: 0.9em;
            color: #FFD700;
            margin-top: 10px;
        }

        .no-quest-message {
            text-align: center;
            padding: 60px 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            border: 2px dashed rgba(255, 255, 255, 0.3);
        }

        .no-quest-message h2 {
            font-size: 2em;
            margin-bottom: 15px;
        }

        .no-quest-message p {
            font-size: 1.2em;
            opacity: 0.8;
        }

        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            font-size: 0.9em;
            opacity: 0.8;
        }

        /* INVENTORY MANAGER */
        .inventory-section {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .inventory-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .search-input {
            flex: 1;
            padding: 12px 20px;
            font-size: 1.1em;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            color: #fff;
        }

        .search-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .btn-secondary {
            background: rgba(158, 158, 158, 0.3);
            border: 2px solid #9e9e9e;
            color: #fff;
            padding: 12px 30px;
        }

        .btn-secondary:hover {
            background: rgba(158, 158, 158, 0.5);
        }

        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .inventory-item {
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .inventory-item-icon {
            width: 64px;
            height: 64px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
        }

        .inventory-item-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .inventory-item-name {
            font-weight: bold;
            text-align: center;
            font-size: 0.95em;
        }

        .inventory-item-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .inventory-qty-btn {
            width: 32px;
            height: 32px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.4);
            border-radius: 6px;
            color: #fff;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }

        .inventory-qty-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .inventory-qty-display {
            min-width: 40px;
            text-align: center;
            font-size: 1.3em;
            font-weight: bold;
            color: #4CAF50;
        }

        .floating-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            color: #fff;
            font-size: 2em;
            cursor: pointer;
            box-shadow: 0 6px 25px rgba(76, 175, 80, 0.5);
            transition: all 0.3s;
            z-index: 1000;
        }

        .floating-btn:hover {
            transform: translateY(-5px) scale(1.1);
            box-shadow: 0 10px 35px rgba(76, 175, 80, 0.7);
        }

        .inventory-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #f44336;
            color: #fff;
            font-size: 0.5em;
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 12px;
            min-width: 24px;
            text-align: center;
        }

        @media (max-width: 768px) {
            .quest-grid {
                grid-template-columns: 1fr;
            }

            .inventory-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }

            h1 {
                font-size: 1.8em;
            }

            .quest-title {
                font-size: 1.5em;
            }

            .floating-btn {
                width: 60px;
                height: 60px;
                font-size: 1.5em;
                bottom: 20px;
                right: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>‚öîÔ∏è Arc Raiders - Quest Planner</h1>
            <p class="subtitle" id="player-name">Mission-Based Workshop Progression</p>
        </header>

        <!-- ACTIVE QUEST SECTION -->
        <div class="active-quest-section" id="active-quest-section" style="display:none;">
            <div class="active-quest-card">
                <div class="quest-header">
                    <div>
                        <span class="quest-badge">üéØ ACTIVE QUEST</span>
                        <span class="quest-title" id="active-quest-title"></span>
                        <span id="active-quest-keystone"></span>
                    </div>
                </div>

                <div class="quest-progress">
                    <div class="progress-bar-wrapper">
                        <div class="progress-bar" id="active-progress-bar"></div>
                        <div class="progress-text" id="active-progress-text">0% Complete</div>
                    </div>
                </div>

                <div class="quest-objectives">
                    <h3 class="objectives-title">üìã OBJECTIVES</h3>
                    <ul class="objective-list" id="active-objectives"></ul>
                </div>

                <div class="quest-rewards" id="active-rewards">
                    <h3 class="rewards-title">üéÅ REWARDS</h3>
                    <div class="reward-items" id="active-reward-items"></div>
                </div>

                <div class="quest-suggestions" id="quest-suggestions">
                    <h3 class="suggestions-title">üí° SMART SUGGESTIONS</h3>
                    <div id="suggestions-content"></div>
                </div>

                <div class="quest-actions">
                    <button class="btn btn-complete" id="complete-quest-btn" disabled>
                        ‚úÖ COMPLETE QUEST & LEVEL UP
                    </button>
                    <button class="btn btn-back" id="back-quest-btn">
                        ‚¨ÖÔ∏è BACK TO QUESTS
                    </button>
                    <button class="btn btn-abandon" id="abandon-quest-btn">
                        ‚ùå ABANDON
                    </button>
                </div>
            </div>
        </div>

        <!-- INVENTORY MANAGER -->
        <div class="inventory-section" id="inventory-section" style="display:none;">
            <h2 class="section-title">üì¶ Inventory Manager</h2>
            <div class="inventory-controls">
                <input type="text" id="inventory-search" placeholder="Search materials..." class="search-input">
                <button class="btn btn-secondary" id="close-inventory-btn">‚úï Close</button>
            </div>
            <div class="inventory-grid" id="inventory-grid"></div>
        </div>

        <!-- FLOATING INVENTORY BUTTON -->
        <button class="floating-btn" id="open-inventory-btn" title="Open Inventory Manager">
            üì¶<span class="inventory-count" id="inventory-count">0</span>
        </button>

        <!-- QUEST SELECTION -->
        <div class="quest-selection" id="quest-selection">
            <h2 class="section-title">üìú AVAILABLE QUESTS</h2>
            <div class="quest-grid" id="quest-grid"></div>
        </div>

        <footer>
            <p><strong>Data Sources:</strong> Arc Raiders Wiki | ARDB Tools | GAM3S.GG</p>
            <p>Made for Steve, Alf & Indie | v3.0 (Quest System)</p>
        </footer>
    </div>

    <script id="game-data" type="application/json">
{
  "workstations": {
    "gunsmith": {
      "name": "Gunsmith",
      "icon": "gunsmith.png",
      "levels": [
        {
          "level": 1,
          "requirements": [
            {
              "item": "Metal Parts",
              "quantity": 20,
              "type": "farm"
            },
            {
              "item": "Rubber Parts",
              "quantity": 30,
              "type": "farm"
            }
          ],
          "unlocks": [
            "Basic weapons"
          ]
        },
        {
          "level": 2,
          "requirements": [
            {
              "item": "Rusted Tools",
              "quantity": 3,
              "type": "farm",
              "source": "Mechanical POIs"
            },
            {
              "item": "Mechanical Components",
              "quantity": 5,
              "type": "craft",
              "craftAt": "Refiner Lv1"
            },
            {
              "item": "Wasp Driver",
              "quantity": 8,
              "type": "farm",
              "source": "Kill Wasps"
            }
          ],
          "unlocks": [
            "Better weapons"
          ]
        },
        {
          "level": 3,
          "requirements": [
            {
              "item": "Rusted Gear",
              "quantity": 3,
              "type": "farm",
              "source": "Mechanical POIs"
            },
            {
              "item": "Advanced Mechanical Components",
              "quantity": 5,
              "type": "craft",
              "craftAt": "Refiner Lv2"
            },
            {
              "item": "Sentinel Firing Core",
              "quantity": 4,
              "type": "farm",
              "source": "Kill Sentinels"
            }
          ],
          "unlocks": [
            "Bettina",
            "Renegade",
            "Hullcracker"
          ]
        }
      ]
    },
    "gearBench": {
      "name": "Gear Bench",
      "icon": "gear-bench.png",
      "levels": [
        {
          "level": 1,
          "requirements": [
            {
              "item": "Plastic Parts",
              "quantity": 25,
              "type": "farm"
            },
            {
              "item": "Fabric",
              "quantity": 30,
              "type": "farm"
            }
          ],
          "unlocks": [
            "Light/Medium Shield",
            "Combat/Looting/Tactical Mk.1"
          ]
        },
        {
          "level": 2,
          "requirements": [
            {
              "item": "Power Cable",
              "quantity": 3,
              "type": "farm",
              "source": "Mechanical POIs"
            },
            {
              "item": "Electrical Components",
              "quantity": 5,
              "type": "craft",
              "craftAt": "Refiner Lv1"
            },
            {
              "item": "Hornet Driver",
              "quantity": 5,
              "type": "farm",
              "source": "Kill Hornets"
            }
          ],
          "unlocks": [
            "Heavy Shield",
            "Mk.2 augments"
          ]
        },
        {
          "level": 3,
          "requirements": [
            {
              "item": "Industrial Battery",
              "quantity": 3,
              "type": "farm",
              "source": "Loot containers"
            },
            {
              "item": "Advanced Electrical Components",
              "quantity": 5,
              "type": "craft",
              "craftAt": "Refiner Lv2"
            },
            {
              "item": "Bastion Cell",
              "quantity": 6,
              "type": "farm",
              "source": "Kill Bastions"
            }
          ],
          "unlocks": [
            "Looting Mk.3 (Cautious)"
          ]
        }
      ]
    },
    "medicalLab": {
      "name": "Medical Lab",
      "icon": "medical-lab.png",
      "levels": [
        {
          "level": 1,
          "requirements": [
            {
              "item": "Fabric",
              "quantity": 50,
              "type": "farm"
            },
            {
              "item": "ARC Alloy",
              "quantity": 6,
              "type": "farm"
            }
          ],
          "unlocks": [
            "Herbal Bandage",
            "Shield Recharger",
            "Adrenaline Shot",
            "Bandage"
          ]
        },
        {
          "level": 2,
          "requirements": [
            {
              "item": "Cracked Bioscanner",
              "quantity": 2,
              "type": "farm",
              "source": "Loot containers"
            },
            {
              "item": "Durable Cloth",
              "quantity": 5,
              "type": "craft",
              "craftAt": "Refiner Lv1"
            },
            {
              "item": "Tick Pod",
              "quantity": 8,
              "type": "farm",
              "source": "Kill Ticks"
            }
          ],
          "unlocks": [
            "Sterilized Bandage",
            "Surge Shield Recharger"
          ]
        },
        {
          "level": 3,
          "requirements": [
            {
              "item": "Rusted Shut Medical Kit",
              "quantity": 3,
              "type": "farm",
              "source": "Loot containers"
            },
            {
              "item": "Antiseptic",
              "quantity": 8,
              "type": "craft",
              "craftAt": "Refiner Lv2"
            },
            {
              "item": "Surveyor Vault",
              "quantity": 5,
              "type": "farm",
              "source": "Kill Surveyors"
            }
          ],
          "unlocks": [
            "Vita Spray"
          ]
        }
      ]
    },
    "explosives": {
      "name": "Explosives Station",
      "icon": "explosives.png",
      "levels": [
        {
          "level": 1,
          "requirements": [
            {
              "item": "Chemicals",
              "quantity": 50,
              "type": "farm"
            },
            {
              "item": "ARC Alloy",
              "quantity": 6,
              "type": "farm"
            }
          ],
          "unlocks": [
            "Gas Grenade",
            "Light Impact Grenade"
          ]
        },
        {
          "level": 2,
          "requirements": [
            {
              "item": "Synthesized Fuel",
              "quantity": 3,
              "type": "buy",
              "seedCost": 14
            },
            {
              "item": "Crude Explosives",
              "quantity": 5,
              "type": "craft",
              "craftAt": "Refiner Lv1"
            },
            {
              "item": "Pop Trigger",
              "quantity": 5,
              "type": "farm",
              "source": "Kill Pops"
            }
          ],
          "unlocks": [
            "Blaze Grenade"
          ]
        },
        {
          "level": 3,
          "requirements": [
            {
              "item": "Laboratory Reagents",
              "quantity": 3,
              "type": "farm",
              "source": "Loot containers"
            },
            {
              "item": "Explosive Compound",
              "quantity": 5,
              "type": "farm",
              "source": "Loot containers"
            },
            {
              "item": "Rocketeer Driver",
              "quantity": 3,
              "type": "farm",
              "source": "Kill Rocketeers"
            }
          ],
          "unlocks": [
            "Heavy Fuze Grenade",
            "Wolfpack"
          ]
        }
      ]
    },
    "utility": {
      "name": "Utility Station",
      "icon": "utility.png",
      "levels": [
        {
          "level": 1,
          "requirements": [
            {
              "item": "Plastic Parts",
              "quantity": 50,
              "type": "farm"
            },
            {
              "item": "ARC Alloy",
              "quantity": 6,
              "type": "farm"
            }
          ],
          "unlocks": [
            "Barricade Kit",
            "Binoculars",
            "Door Blocker",
            "Remote Raider Flare",
            "Smoke Grenade"
          ]
        },
        {
          "level": 2,
          "requirements": [
            {
              "item": "Damaged Heat Sink",
              "quantity": 2,
              "type": "farm",
              "source": "Loot containers"
            },
            {
              "item": "Electrical Components",
              "quantity": 5,
              "type": "craft",
              "craftAt": "Refiner Lv1"
            },
            {
              "item": "Snitch Scanner",
              "quantity": 6,
              "type": "farm",
              "source": "Kill Snitches"
            }
          ],
          "unlocks": [
            "Lure Grenade",
            "Zipline"
          ]
        },
        {
          "level": 3,
          "requirements": [
            {
              "item": "Fried Motherboard",
              "quantity": 3,
              "type": "farm",
              "source": "Loot containers"
            },
            {
              "item": "Advanced Electrical Components",
              "quantity": 5,
              "type": "craft",
              "craftAt": "Refiner Lv2"
            },
            {
              "item": "Leaper Pulse Unit",
              "quantity": 4,
              "type": "farm",
              "source": "Kill Leapers (Bisons)"
            }
          ],
          "unlocks": [
            "Photoelectric Cloak",
            "Snap Hook",
            "Tagging Grenade"
          ]
        }
      ]
    },
    "refiner": {
      "name": "Refiner",
      "icon": "refiner.png",
      "keystone": true,
      "levels": [
        {
          "level": 1,
          "requirements": [
            {
              "item": "Metal Parts",
              "quantity": 60,
              "type": "farm",
              "note": "NEEDS VERIFICATION"
            },
            {
              "item": "ARC Powercell",
              "quantity": 5,
              "type": "farm",
              "note": "NEEDS VERIFICATION"
            }
          ],
          "unlocks": [
            "Mechanical Components",
            "Electrical Components",
            "Crude Explosives",
            "Durable Cloth"
          ]
        },
        {
          "level": 2,
          "requirements": [
            {
              "item": "Toaster",
              "quantity": 3,
              "type": "farm",
              "source": "Mechanical POIs"
            },
            {
              "item": "ARC Motion Core",
              "quantity": 5,
              "type": "farm",
              "source": "Kill Surveyors/Probes"
            },
            {
              "item": "Fireball Burner",
              "quantity": 8,
              "type": "farm",
              "source": "Kill Fireballs"
            }
          ],
          "unlocks": [
            "Advanced Mechanical Components",
            "Advanced Electrical Components",
            "Antiseptic",
            "ARC Circuitry"
          ]
        },
        {
          "level": 3,
          "requirements": [
            {
              "item": "Motor",
              "quantity": 3,
              "type": "farm",
              "source": "Loot containers"
            },
            {
              "item": "ARC Circuitry",
              "quantity": 10,
              "type": "craft",
              "craftAt": "Refiner Lv2"
            },
            {
              "item": "Bombardier Cell",
              "quantity": 6,
              "type": "farm",
              "source": "Kill Bombardiers"
            }
          ],
          "unlocks": [
            "Magnetic Accelerator",
            "Mod Components",
            "Power Rod"
          ]
        }
      ]
    },
    "scrappy": {
      "name": "Scrappy (The Rooster)",
      "icon": "scrappy.png",
      "levels": [
        {
          "level": 2,
          "name": "Forager",
          "requirements": [
            {
              "item": "Dog Collar",
              "quantity": 1,
              "type": "farm",
              "source": "Residential areas"
            }
          ],
          "unlocks": [
            "Increased resource collection"
          ]
        },
        {
          "level": 3,
          "name": "Scavenger",
          "requirements": [
            {
              "item": "Lemon",
              "quantity": 3,
              "type": "farm",
              "source": "Kick trees (Blue Gate NW Village)"
            },
            {
              "item": "Apricot",
              "quantity": 3,
              "type": "farm",
              "source": "Kick trees (Blue Gate NW Village)"
            }
          ],
          "unlocks": [
            "+Chemicals",
            "+Rubber Parts to drops"
          ]
        },
        {
          "level": 4,
          "name": "Treasure Hunter",
          "requirements": [
            {
              "item": "Prickly Pear",
              "quantity": 6,
              "type": "farm",
              "source": "Ground spawn"
            },
            {
              "item": "Olive",
              "quantity": 6,
              "type": "farm",
              "source": "Kick trees (Blue Gate Olive Grove)"
            },
            {
              "item": "Cat Bed",
              "quantity": 1,
              "type": "farm",
              "source": "Residential areas"
            }
          ],
          "unlocks": [
            "Improved haul rate"
          ]
        },
        {
          "level": 5,
          "name": "Master Hoarder",
          "requirements": [
            {
              "item": "Olive",
              "quantity": 6,
              "type": "farm",
              "source": "Kick trees (Blue Gate Olive Grove)"
            },
            {
              "item": "Mushroom",
              "quantity": 6,
              "type": "farm",
              "source": "Ground spawn"
            },
            {
              "item": "Very Comfortable Pillow",
              "quantity": 3,
              "type": "farm",
              "source": "Residential areas"
            }
          ],
          "unlocks": [
            "Maximum resource capacity"
          ]
        }
      ]
    }
  },
  "refinerRecipes": {
    "level1": [
      {
        "output": "Mechanical Components",
        "ingredients": [
          {
            "item": "Metal Parts",
            "quantity": 7
          },
          {
            "item": "Rubber Parts",
            "quantity": 3
          }
        ]
      },
      {
        "output": "Electrical Components",
        "ingredients": [
          {
            "item": "Plastic Parts",
            "quantity": 8
          },
          {
            "item": "Rubber Parts",
            "quantity": 4
          }
        ]
      },
      {
        "output": "Crude Explosives",
        "ingredients": [
          {
            "item": "Chemicals",
            "quantity": "TBD"
          }
        ]
      },
      {
        "output": "Durable Cloth",
        "ingredients": [
          {
            "item": "Fabric",
            "quantity": "TBD"
          }
        ]
      }
    ],
    "level2": [
      {
        "output": "Advanced Mechanical Components",
        "ingredients": [
          {
            "item": "Mechanical Components",
            "quantity": "TBD"
          },
          {
            "item": "ARC Alloy",
            "quantity": "TBD"
          }
        ]
      },
      {
        "output": "Advanced Electrical Components",
        "ingredients": [
          {
            "item": "Electrical Components",
            "quantity": "TBD"
          },
          {
            "item": "ARC Alloy",
            "quantity": "TBD"
          }
        ]
      },
      {
        "output": "Antiseptic",
        "ingredients": [
          {
            "item": "Chemicals",
            "quantity": "TBD"
          },
          {
            "item": "Durable Cloth",
            "quantity": "TBD"
          }
        ]
      },
      {
        "output": "ARC Circuitry",
        "ingredients": [
          {
            "item": "ARC Powercell",
            "quantity": "TBD"
          },
          {
            "item": "Electrical Components",
            "quantity": "TBD"
          }
        ]
      },
      {
        "output": "Heavy Gun Parts",
        "ingredients": [
          {
            "item": "Simple Gun Parts",
            "quantity": 4
          }
        ]
      }
    ],
    "level3": [
      {
        "output": "Magnetic Accelerator",
        "ingredients": [
          {
            "item": "TBD",
            "quantity": "TBD"
          }
        ]
      },
      {
        "output": "Mod Components",
        "ingredients": [
          {
            "item": "TBD",
            "quantity": "TBD"
          }
        ]
      },
      {
        "output": "Power Rod",
        "ingredients": [
          {
            "item": "TBD",
            "quantity": "TBD"
          }
        ]
      }
    ]
  },
  "celesteShop": {
    "basicMaterials": [
      {
        "item": "Chemicals",
        "seeds": 1,
        "stock": "unlimited"
      },
      {
        "item": "Fabric",
        "seeds": 1,
        "stock": "unlimited"
      },
      {
        "item": "Metal Parts",
        "seeds": 1,
        "stock": "unlimited"
      },
      {
        "item": "Plastic Parts",
        "seeds": 1,
        "stock": "unlimited"
      },
      {
        "item": "Rubber Parts",
        "seeds": 1,
        "stock": "unlimited"
      }
    ],
    "commonMaterials": [
      {
        "item": "Wires",
        "seeds": 4,
        "stock": 10
      },
      {
        "item": "Battery",
        "seeds": 5,
        "stock": 10
      },
      {
        "item": "Great Mullein",
        "seeds": 5,
        "stock": 10
      },
      {
        "item": "Canister",
        "seeds": 6,
        "stock": 10
      },
      {
        "item": "Duct Tape",
        "seeds": 6,
        "stock": 10
      },
      {
        "item": "Magnet",
        "seeds": 6,
        "stock": 10
      },
      {
        "item": "Oil",
        "seeds": 6,
        "stock": 10
      },
      {
        "item": "Steel Spring",
        "seeds": 6,
        "stock": 10,
        "helpsWith": "Craft Mechanical Components at Refiner"
      }
    ],
    "midTier": [
      {
        "item": "Simple Gun Parts",
        "seeds": 7,
        "stock": 5,
        "helpsWith": "Weapon upgrades"
      },
      {
        "item": "Moss",
        "seeds": 10,
        "stock": 5
      },
      {
        "item": "Processor",
        "seeds": 10,
        "stock": 5,
        "helpsWith": "Mk.3 augments"
      },
      {
        "item": "Rope",
        "seeds": 10,
        "stock": 5
      },
      {
        "item": "Sensors",
        "seeds": 10,
        "stock": 5,
        "helpsWith": "Raider Keys, Wolfpack blueprints"
      },
      {
        "item": "Speaker Component",
        "seeds": 10,
        "stock": 5
      },
      {
        "item": "Syringe",
        "seeds": 10,
        "stock": 5
      },
      {
        "item": "Voltage Converter",
        "seeds": 10,
        "stock": 5
      },
      {
        "item": "Synthesized Fuel",
        "seeds": 14,
        "stock": 5,
        "helpsWith": "Explosives Lv2 (need 3)"
      }
    ],
    "gunParts": [
      {
        "item": "Light Gun Parts",
        "seeds": 15,
        "stock": 3
      },
      {
        "item": "Medium Gun Parts",
        "seeds": 15,
        "stock": 3
      },
      {
        "item": "Heavy Gun Parts",
        "seeds": 15,
        "stock": 3
      }
    ],
    "premium": [
      {
        "item": "Exodus Modules",
        "seeds": 55,
        "stock": 1,
        "helpsWith": "High-tier weapon blueprints"
      },
      {
        "item": "Complex Gun Parts",
        "seeds": 60,
        "stock": 1,
        "helpsWith": "Premium weapon blueprints"
      }
    ]
  },
  "crossReferences": {
    "multipleUse": [
      {
        "material": "Electrical Components",
        "usedBy": [
          "Gear Bench Lv2 (5)",
          "Utility Lv2 (5)"
        ],
        "totalNeeded": 10,
        "canCraft": true,
        "craftAt": "Refiner Lv1"
      },
      {
        "material": "Advanced Electrical Components",
        "usedBy": [
          "Gear Bench Lv3 (5)",
          "Utility Lv3 (5)"
        ],
        "totalNeeded": 10,
        "canCraft": true,
        "craftAt": "Refiner Lv2"
      },
      {
        "material": "ARC Alloy",
        "usedBy": [
          "Medical Lv1 (6)",
          "Explosives Lv1 (6)",
          "Utility Lv1 (6)"
        ],
        "totalNeeded": 18,
        "canCraft": false
      },
      {
        "material": "Fabric",
        "usedBy": [
          "Medical Lv1 (50)",
          "Gear Bench Lv1 (30)"
        ],
        "totalNeeded": 80,
        "canCraft": false
      },
      {
        "material": "Plastic Parts",
        "usedBy": [
          "Utility Lv1 (50)",
          "Gear Bench Lv1 (25)"
        ],
        "totalNeeded": 75,
        "canCraft": false
      }
    ]
  },
  "dependencyChains": {
    "refinerLv1": {
      "unlocks": [
        {
          "material": "Mechanical Components",
          "enables": "Gunsmith Lv2"
        },
        {
          "material": "Electrical Components",
          "enables": "Gear Bench Lv2, Utility Lv2"
        },
        {
          "material": "Crude Explosives",
          "enables": "Explosives Lv2"
        },
        {
          "material": "Durable Cloth",
          "enables": "Medical Lv2"
        }
      ]
    },
    "refinerLv2": {
      "unlocks": [
        {
          "material": "Advanced Mechanical Components",
          "enables": "Gunsmith Lv3"
        },
        {
          "material": "Advanced Electrical Components",
          "enables": "Gear Bench Lv3, Utility Lv3"
        },
        {
          "material": "Antiseptic",
          "enables": "Medical Lv3"
        },
        {
          "material": "ARC Circuitry",
          "enables": "Refiner Lv3"
        }
      ]
    }
  },
  "playerStatus": {
    "steve": {
      "workstations": {
        "gunsmith": 1,
        "gearBench": 1,
        "medicalLab": 1,
        "explosives": 1,
        "utility": 1,
        "refiner": 1,
        "scrappy": 3
      }
    },
    "alf": {
      "workstations": {
        "gunsmith": 1,
        "gearBench": 1,
        "medicalLab": 1,
        "explosives": 1,
        "utility": 1,
        "refiner": 1,
        "scrappy": 1
      }
    },
    "indie": {
      "workstations": {
        "gunsmith": 1,
        "gearBench": 1,
        "medicalLab": 1,
        "explosives": 1,
        "utility": 1,
        "refiner": 1,
        "scrappy": 1
      }
    }
  }
}
    </script>

    <script>
        let gameData = null;
        let currentPlayer = null;
        let playerData = {};

        // Load game data
        try {
            const dataScript = document.getElementById('game-data');
            gameData = JSON.parse(dataScript.textContent);
            initializeApp();
        } catch (error) {
            console.error('Error loading game data:', error);
            alert('Failed to load game data. Please refresh the page.');
        }

        function initializeApp() {
            loadPlayerData();

            // Quest actions
            document.getElementById('complete-quest-btn').addEventListener('click', completeQuest);
            document.getElementById('back-quest-btn').addEventListener('click', backToQuests);
            document.getElementById('abandon-quest-btn').addEventListener('click', abandonQuest);

            // Inventory actions
            document.getElementById('open-inventory-btn').addEventListener('click', openInventory);
            document.getElementById('close-inventory-btn').addEventListener('click', closeInventory);
            document.getElementById('inventory-search').addEventListener('input', filterInventory);

            // Get player from URL parameter or localStorage
            const urlParams = new URLSearchParams(window.location.search);
            const playerParam = urlParams.get('player');
            const savedPlayer = localStorage.getItem('arcRaidersPlayer') || 'steve';
            const player = playerParam || savedPlayer;

            // Save player choice if from URL
            if (playerParam) {
                localStorage.setItem('arcRaidersPlayer', playerParam);
            }

            selectPlayer(player);
        }

        function loadPlayerData() {
            const saved = localStorage.getItem('arcRaidersPlayerData');
            if (saved) {
                playerData = JSON.parse(saved);
            } else {
                playerData = {
                    steve: {
                        activeQuest: null,
                        questProgress: {},
                        workstations: gameData.playerStatus.steve.workstations,
                        inventory: {}
                    },
                    alf: {
                        activeQuest: null,
                        questProgress: {},
                        workstations: gameData.playerStatus.alf.workstations,
                        inventory: {}
                    },
                    indie: {
                        activeQuest: null,
                        questProgress: {},
                        workstations: gameData.playerStatus.indie.workstations,
                        inventory: {}
                    }
                };
                savePlayerData();
            }
        }

        function savePlayerData() {
            localStorage.setItem('arcRaidersPlayerData', JSON.stringify(playerData));
        }

        // Enemy spawn relationships - what spawns together
        const enemySpawns = {
            'Wasp Driver': {
                enemies: ['Wasps'],
                spawnsWith: ['Hornet Driver'],
                locations: ['Open areas', 'Near ARC activity']
            },
            'Hornet Driver': {
                enemies: ['Hornets'],
                spawnsWith: ['Wasp Driver'],
                locations: ['Open areas', 'Near ARC activity']
            },
            'Fireball Burner': {
                enemies: ['Fireballs'],
                spawnsWith: ['Tick Pod'],
                locations: ['Underground areas', 'Indoor buildings', 'Caves']
            },
            'Tick Pod': {
                enemies: ['Ticks'],
                spawnsWith: ['Fireball Burner'],
                locations: ['Underground areas', 'Near Fireball spawns']
            },
            'Pop Trigger': {
                enemies: ['Pops'],
                spawnsWith: ['Snitch Scanner'],
                locations: ['Common ARC patrols']
            },
            'Snitch Scanner': {
                enemies: ['Snitches'],
                spawnsWith: ['Pop Trigger'],
                locations: ['Common ARC patrols']
            },
            'Surveyor Vault': {
                enemies: ['Surveyors'],
                spawnsWith: ['ARC Motion Core'],
                locations: ['Blue beam in sky', 'High-value areas']
            },
            'ARC Motion Core': {
                enemies: ['Surveyors', 'Probes'],
                spawnsWith: ['Surveyor Vault'],
                locations: ['Blue beam in sky', 'Beeping probes']
            }
        };

        function selectPlayer(player) {
            currentPlayer = player;
            localStorage.setItem('arcRaidersPlayer', player);

            // Show player name in header
            const playerNameElement = document.getElementById('player-name');
            const playerNameDisplay = player.charAt(0).toUpperCase() + player.slice(1);
            playerNameElement.textContent = `${playerNameDisplay}'s Workshop Planner`;

            renderUI();
        }

        function renderUI() {
            const player = playerData[currentPlayer];

            if (player.activeQuest) {
                renderActiveQuest();
                document.getElementById('active-quest-section').style.display = 'block';
                document.getElementById('quest-selection').style.display = 'none';
            } else {
                renderQuestSelection();
                document.getElementById('active-quest-section').style.display = 'none';
                document.getElementById('quest-selection').style.display = 'block';
            }

            updateInventoryCount();
        }

        function renderActiveQuest() {
            const player = playerData[currentPlayer];
            const quest = player.activeQuest;
            const station = gameData.workstations[quest.stationKey];
            const level = station.levels.find(l => l.level === quest.targetLevel);

            // Title
            document.getElementById('active-quest-title').textContent = quest.name;
            document.getElementById('active-quest-keystone').innerHTML =
                station.keystone ? '<span class="keystone-badge">üîë KEYSTONE</span>' : '';

            // Progress
            const progress = calculateQuestProgress(quest);
            document.getElementById('active-progress-bar').style.width = progress + '%';
            document.getElementById('active-progress-text').textContent = progress + '% Complete';

            // Enable complete button if 100%
            document.getElementById('complete-quest-btn').disabled = progress < 100;

            // Objectives
            const objectivesHTML = level.requirements.map(req => {
                const completed = isObjectiveCompleted(quest, req.item);
                const iconPath = getIconPath(req.item);
                const inInventory = player.inventory[req.item] || 0;
                const needed = Math.max(0, req.quantity - inInventory);

                let inventoryStatus = '';
                if (inInventory > 0) {
                    if (inInventory >= req.quantity) {
                        inventoryStatus = `<span style="color: #4CAF50;">‚úì Have ${inInventory}/${req.quantity}</span>`;
                    } else {
                        inventoryStatus = `<span style="color: #ff9800;">Need ${needed} more (have ${inInventory})</span>`;
                    }
                }

                return `
                    <li class="objective-item ${req.type} ${completed ? 'completed' : ''}">
                        <input type="checkbox" class="objective-checkbox"
                            ${completed ? 'checked' : ''}
                            data-item="${req.item}"
                            onchange="toggleObjective('${req.item}')">
                        <div class="objective-icon">
                            ${iconPath ? `<img src="${iconPath}" alt="${req.item}">` : getTypeIcon(req.type)}
                        </div>
                        <div class="objective-details">
                            <div class="objective-name">
                                ${req.item}
                                <span class="objective-quantity">√ó${req.quantity}</span>
                                <span class="type-badge ${req.type}">${req.type.toUpperCase()}</span>
                            </div>
                            <div class="objective-source">
                                ${getSourceText(req)}
                                ${inventoryStatus ? `<br>${inventoryStatus}` : ''}
                            </div>
                        </div>
                    </li>
                `;
            }).join('');
            document.getElementById('active-objectives').innerHTML = objectivesHTML;

            // Rewards
            const rewardsHTML = level.unlocks.map(unlock =>
                `<div class="reward-item">${unlock}</div>`
            ).join('');
            document.getElementById('active-reward-items').innerHTML = rewardsHTML;

            // Smart Suggestions
            renderSmartSuggestions(quest, level);
        }

        function renderSmartSuggestions(quest, level) {
            const player = playerData[currentPlayer];
            const suggestions = [];

            // 1. Enemy spawn co-locations
            const enemyDrops = level.requirements.filter(req => req.type === 'farm' && enemySpawns[req.item]);
            const coLocationSuggestions = [];
            const processed = new Set();

            enemyDrops.forEach(req => {
                const spawnInfo = enemySpawns[req.item];
                if (spawnInfo.spawnsWith) {
                    spawnInfo.spawnsWith.forEach(otherDrop => {
                        if (!processed.has(otherDrop)) {
                            // Check if this other drop is needed for future quests
                            const futureUse = findFutureUses(otherDrop, player);
                            if (futureUse.length > 0) {
                                coLocationSuggestions.push({
                                    mainItem: req.item,
                                    bonusItem: otherDrop,
                                    location: spawnInfo.locations[0],
                                    futureUse: futureUse
                                });
                                processed.add(otherDrop);
                            }
                        }
                    });
                }
            });

            if (coLocationSuggestions.length > 0) {
                suggestions.push({
                    title: 'üéØ OPTIMIZE YOUR RUN',
                    items: coLocationSuggestions.map(s =>
                        `While farming <strong>${s.mainItem}</strong> at ${s.location}, also grab <strong>${s.bonusItem}</strong> <span class="keep-badge">SAVE FOR LATER</span><br>
                        <small style="opacity:0.8;">‚Ü≥ Needed for: ${s.futureUse.join(', ')}</small>`
                    )
                });
            }

            // 2. Cross-reference warnings - items needed by multiple future upgrades
            const crossRefWarnings = [];
            level.requirements.forEach(req => {
                const futureUses = findFutureUses(req.item, player);
                if (futureUses.length > 1) {
                    crossRefWarnings.push({
                        item: req.item,
                        quantity: req.quantity,
                        uses: futureUses
                    });
                }
            });

            if (crossRefWarnings.length > 0) {
                suggestions.push({
                    title: '‚ö†Ô∏è MULTI-USE MATERIALS',
                    items: crossRefWarnings.map(w =>
                        `<strong>${w.item}</strong> is also needed for: ${w.uses.join(', ')} <span class="warning-badge">FARM EXTRA</span>`
                    )
                });
            }

            // 3. Craftable alternatives reminder
            const craftables = level.requirements.filter(req => req.type === 'craft');
            if (craftables.length > 0) {
                suggestions.push({
                    title: 'üîß CRAFT THESE (Don\'t Farm!)',
                    items: craftables.map(c =>
                        `<strong>${c.item}</strong> can be crafted at ${c.craftAt} - check Refiner recipes`
                    )
                });
            }

            // Render suggestions
            if (suggestions.length === 0) {
                document.getElementById('suggestions-content').innerHTML =
                    '<div style="opacity: 0.7;">No optimization suggestions for this quest.</div>';
            } else {
                const suggestionsHTML = suggestions.map(group => `
                    <div class="suggestion-group">
                        <h4>${group.title}</h4>
                        ${group.items.map(item => `<div class="suggestion-item">${item}</div>`).join('')}
                    </div>
                `).join('');
                document.getElementById('suggestions-content').innerHTML = suggestionsHTML;
            }
        }

        function findFutureUses(itemName, player) {
            const futureUses = [];

            for (const [key, station] of Object.entries(gameData.workstations)) {
                const currentLevel = player.workstations[key];
                const futureLevels = station.levels.filter(l => l.level > currentLevel);

                futureLevels.forEach(lvl => {
                    const needsItem = lvl.requirements.find(req => req.item === itemName);
                    if (needsItem) {
                        futureUses.push(`${station.name} Lv${lvl.level}`);
                    }
                });
            }

            return futureUses;
        }

        function renderQuestSelection() {
            const player = playerData[currentPlayer];
            const quests = generateAvailableQuests();

            if (quests.length === 0) {
                document.getElementById('quest-grid').innerHTML = `
                    <div class="no-quest-message" style="grid-column: 1/-1;">
                        <h2>üéâ ALL QUESTS COMPLETE!</h2>
                        <p>You've maxed out all workstations!</p>
                    </div>
                `;
                return;
            }

            const questsHTML = quests.map(quest => {
                const isCompleted = player.workstations[quest.stationKey] >= quest.targetLevel;

                // Calculate progress if this is the active quest
                let progressPercent = 0;
                let progressHTML = '';

                if (player.activeQuest &&
                    player.activeQuest.stationKey === quest.stationKey &&
                    player.activeQuest.targetLevel === quest.targetLevel) {
                    progressPercent = calculateQuestProgressForCard(player.activeQuest, quest.stationKey, quest.targetLevel);
                    progressHTML = `
                        <div style="margin-top: 10px;">
                            <div style="background: rgba(0,0,0,0.4); border-radius: 10px; height: 8px; overflow: hidden;">
                                <div style="background: linear-gradient(90deg, #4CAF50, #8BC34A); height: 100%; width: ${progressPercent}%; transition: width 0.3s;"></div>
                            </div>
                            <div style="color: #4CAF50; margin-top: 5px; font-weight: bold;">üéØ ${progressPercent}% Complete</div>
                        </div>
                    `;
                }

                return `
                    <div class="quest-card ${isCompleted ? 'completed' : ''}"
                         onclick="selectQuest('${quest.stationKey}', ${quest.targetLevel})">
                        <div class="quest-card-header">
                            <div class="quest-card-title">${quest.name}</div>
                            <div class="quest-level">Lv ${quest.targetLevel}</div>
                        </div>
                        <div class="quest-summary">${quest.description}</div>
                        <div class="quest-requirements">
                            ${quest.requirementCount} objectives
                        </div>
                        ${isCompleted ? '<div style="color: #4CAF50; margin-top: 10px;">‚úÖ Completed</div>' : ''}
                        ${progressHTML}
                    </div>
                `;
            }).join('');

            document.getElementById('quest-grid').innerHTML = questsHTML;
        }

        function generateAvailableQuests() {
            const player = playerData[currentPlayer];
            const quests = [];

            for (const [key, station] of Object.entries(gameData.workstations)) {
                const currentLevel = player.workstations[key];
                const nextLevel = station.levels.find(l => l.level === currentLevel + 1);

                if (nextLevel) {
                    quests.push({
                        stationKey: key,
                        targetLevel: nextLevel.level,
                        name: `Upgrade ${station.name} to Level ${nextLevel.level}`,
                        description: nextLevel.name || `Unlock new crafting recipes and items`,
                        requirementCount: nextLevel.requirements.length,
                        isKeystone: station.keystone || false
                    });
                }
            }

            return quests;
        }

        function selectQuest(stationKey, targetLevel) {
            const player = playerData[currentPlayer];
            const station = gameData.workstations[stationKey];

            player.activeQuest = {
                stationKey: stationKey,
                targetLevel: targetLevel,
                name: `Upgrade ${station.name} to Level ${targetLevel}`,
                progress: {}
            };

            savePlayerData();
            renderUI();
        }

        function toggleObjective(itemName) {
            const player = playerData[currentPlayer];
            const quest = player.activeQuest;

            if (!quest.progress) quest.progress = {};

            // Toggle the objective
            const currentState = quest.progress[itemName] || false;
            quest.progress[itemName] = !currentState;

            // Immediate save
            savePlayerData();

            // Re-render to show updated progress
            renderActiveQuest();
        }

        function isObjectiveCompleted(quest, itemName) {
            return quest.progress && quest.progress[itemName];
        }

        function calculateQuestProgress(quest) {
            const station = gameData.workstations[quest.stationKey];
            const level = station.levels.find(l => l.level === quest.targetLevel);

            if (!level.requirements.length) return 0;

            const completed = level.requirements.filter(req =>
                isObjectiveCompleted(quest, req.item)
            ).length;

            return Math.round((completed / level.requirements.length) * 100);
        }

        function calculateQuestProgressForCard(quest, stationKey, targetLevel) {
            const station = gameData.workstations[stationKey];
            const level = station.levels.find(l => l.level === targetLevel);

            if (!level || !level.requirements.length) return 0;

            const completed = level.requirements.filter(req =>
                isObjectiveCompleted(quest, req.item)
            ).length;

            return Math.round((completed / level.requirements.length) * 100);
        }

        function completeQuest() {
            const player = playerData[currentPlayer];
            const quest = player.activeQuest;

            // Level up workstation
            player.workstations[quest.stationKey] = quest.targetLevel;

            // Clear active quest
            player.activeQuest = null;

            savePlayerData();

            // Show success message
            alert(`üéâ Quest Complete! ${quest.name} finished!`);

            renderUI();
        }

        function backToQuests() {
            // Save progress but don't clear quest - allows resume
            renderUI();
            document.getElementById('active-quest-section').style.display = 'none';
            document.getElementById('quest-selection').style.display = 'block';
        }

        function abandonQuest() {
            if (!confirm('Are you sure you want to abandon this quest? Progress will be lost.')) return;

            playerData[currentPlayer].activeQuest = null;
            savePlayerData();
            renderUI();
        }

        function getIconPath(itemName) {
            const filename = itemName.replace(/ /g, '_') + '.png';
            const availableIcons = [
                'Metal_Parts', 'Fabric', 'Chemicals', 'Mechanical_Components', 'Wasp_Driver',
                'Electrical_Components', 'Hornet_Driver', 'ARC_Alloy', 'Cracked_Bioscanner',
                'Durable_Cloth', 'Crude_Explosives', 'Damaged_Heat_Sink', 'ARC_Motion_Core',
                'Fireball_Burner', 'Industrial_Battery', 'Advanced_Electrical_Components',
                'Bastion_Cell', 'Advanced_Mechanical_Components', 'Antiseptic',
                'Laboratory_Reagents', 'Explosive_Compound', 'Rocketeer_Driver',
                'Fried_Motherboard', 'Leaper_Pulse_Unit', 'Motor', 'ARC_Circuitry',
                'Bombardier_Cell', 'Dog_Collar', 'Lemon', 'Apricot', 'Mushroom',
                'ARC_Powercell', 'Cat_Bed'
            ];

            const filenameStem = filename.replace('.png', '');
            return availableIcons.includes(filenameStem) ? `images/materials/${filename}` : null;
        }

        function getTypeIcon(type) {
            const icons = { farm: 'üåæ', craft: '‚úÖ', buy: 'üí∞' };
            return icons[type] || '‚ùì';
        }

        function getSourceText(req) {
            if (req.type === 'farm' && req.source) return `üìç ${req.source}`;
            if (req.type === 'craft' && req.craftAt) return `üîß Craft at ${req.craftAt}`;
            if (req.type === 'buy' && req.seedCost) return `üí∞ Buy from Celeste (${req.seedCost} seeds)`;
            return '';
        }

        // INVENTORY MANAGEMENT
        function openInventory() {
            document.getElementById('inventory-section').style.display = 'block';
            document.getElementById('quest-selection').style.display = 'none';
            document.getElementById('active-quest-section').style.display = 'none';
            renderInventory();
        }

        function closeInventory() {
            document.getElementById('inventory-section').style.display = 'none';
            renderUI(); // Return to previous view
        }

        function renderInventory() {
            const player = playerData[currentPlayer];
            if (!player.inventory) player.inventory = {};

            // Get all unique materials from game data
            const allMaterials = new Set();

            Object.values(gameData.workstations).forEach(station => {
                station.levels.forEach(level => {
                    level.requirements.forEach(req => {
                        allMaterials.add(req.item);
                    });
                });
            });

            // Sort alphabetically
            const sortedMaterials = Array.from(allMaterials).sort();

            const inventoryHTML = sortedMaterials.map(material => {
                const quantity = player.inventory[material] || 0;
                const iconPath = getIconPath(material);

                return `
                    <div class="inventory-item">
                        <div class="inventory-item-icon">
                            ${iconPath ? `<img src="${iconPath}" alt="${material}">` : 'üì¶'}
                        </div>
                        <div class="inventory-item-name">${material}</div>
                        <div class="inventory-item-controls">
                            <button class="inventory-qty-btn" onclick="updateInventory('${material}', -1)">‚àí</button>
                            <div class="inventory-qty-display">${quantity}</div>
                            <button class="inventory-qty-btn" onclick="updateInventory('${material}', 1)">+</button>
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('inventory-grid').innerHTML = inventoryHTML;
            updateInventoryCount();
        }

        function updateInventory(material, delta) {
            const player = playerData[currentPlayer];
            if (!player.inventory) player.inventory = {};

            const currentQty = player.inventory[material] || 0;
            const newQty = Math.max(0, currentQty + delta);

            if (newQty === 0) {
                delete player.inventory[material];
            } else {
                player.inventory[material] = newQty;
            }

            savePlayerData();
            renderInventory();
        }

        function updateInventoryCount() {
            const player = playerData[currentPlayer];
            const totalItems = Object.values(player.inventory || {}).reduce((sum, qty) => sum + qty, 0);
            document.getElementById('inventory-count').textContent = totalItems;
        }

        function filterInventory() {
            const searchTerm = document.getElementById('inventory-search').value.toLowerCase();
            const items = document.querySelectorAll('.inventory-item');

            items.forEach(item => {
                const name = item.querySelector('.inventory-item-name').textContent.toLowerCase();
                item.style.display = name.includes(searchTerm) ? 'flex' : 'none';
            });
        }

        // Update inventory count on load
        document.addEventListener('DOMContentLoaded', () => {
            if (currentPlayer && playerData[currentPlayer]) {
                updateInventoryCount();
            }
        });
    </script>
</body>
</html>
